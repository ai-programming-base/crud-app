<!DOCTYPE html>
<html>
<head>
    <title>ユーザー修正</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { background:#f6f8fa; font-family:'Segoe UI','Meiryo',sans-serif; display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; }
        .card { background:#fff; padding:32px 32px 20px 32px; border-radius:14px; box-shadow:0 4px 16px rgba(80,120,200,0.11); min-width:300px; max-width:390px; width:100%; margin:0 auto; text-align:center; }
        h1 { margin-top:0; color:#306090; letter-spacing:2px; font-size:1.4rem; }
        .form-group { margin:16px 0 10px 0; text-align:left; }
        label { font-size:1rem; color:#444; display:block; margin-bottom:5px; }
        input[type="text"], input[type="password"], input[type="email"] {
            width:100%; padding:10px 9px; margin-top:6px; border:1.5px solid #bed8fa; border-radius:5px; font-size:1rem; box-sizing:border-box; transition:border .18s; margin-bottom:0;
        }
        input[type="text"]:focus, input[type="password"]:focus, input[type="email"]:focus { border-color:#5090f9; outline:none; }
        .roles-group { text-align:left; margin:12px 0 18px 0; }
        .role-checkbox { margin-right:7px; margin-bottom:2px; transform:scale(1.07); vertical-align:middle; }
        .roles-group label { display:inline-block; margin-right:18px; margin-bottom:4px; }
        .btn { width:100%; background:#2e854b; color:#fff; border:none; border-radius:6px; font-size:1rem; font-weight:bold; padding:10px 0; cursor:pointer; transition:background .17s; }
        .btn:hover { background:#216737; }
        .link { display:block; margin-top:17px; color:#3161c4; text-decoration:none; font-size:.98rem; }
        .link:hover { text-decoration:underline; }
        .alert { background:#fff1f1; color:#db4437; padding:10px 13px; border-radius:5px; margin-bottom:14px; font-weight:bold; border-left:4px solid #db4437; text-align:left; }
        .hint { font-size:.9rem; color:#666; text-align:left; margin-top:4px; }
    </style>
</head>
<body>
    <form class="card" method="post" autocomplete="off">
        <h1>ユーザー修正</h1>
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert">
              {% for msg in messages %}{{ msg }}<br>{% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <div class="form-group">
            <label for="username">ユーザー名</label>
            <input type="text" id="username" name="username" value="{{ user['username'] }}" required>
        </div>

        <div class="form-group">
            <label for="password">パスワード（変更時のみ入力）</label>
            <input type="password" id="password" name="password" placeholder="未入力なら変更しません">
            <div class="hint">空のまま送信するとパスワードは変更されません。</div>
        </div>

        <div class="form-group">
            <label for="email">メールアドレス</label>
            <input type="email" name="email" id="email" value="{{ user['email'] }}" required>
        </div>

        <div class="form-group">
            <label for="department">所属部門</label>
            <input type="text" name="department" id="department" value="{{ user['department'] or '' }}">
        </div>

        <div class="form-group">
            <label for="realname">氏名</label>
            <input type="text" name="realname" id="realname" value="{{ user['realname'] or '' }}">
        </div>

        <div class="roles-group">
            <span style="font-weight:bold;color:#444;">ロールを選択（複数可）</span><br>
            {% for r in roles %}
                <label>
                    <input type="checkbox" class="role-checkbox" name="roles" value="{{ r['id'] }}"
                        {% if r['id']|string in current_role_ids %}checked{% endif %}>
                    {{ r['name'] }}
                </label><br>
            {% endfor %}
        </div>

        <button class="btn" type="submit">更新</button>
        <a class="link" href="{{ url_for('index') }}">一覧へ戻る</a>
    </form>
</body>
</html>
